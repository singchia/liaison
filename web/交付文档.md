# Liaison ç½‘ç»œè®¿é—® - å‰ç«¯æ–‡æ¡£

**é¡¹ç›®åç§°ï¼š** Liaison  
**ç‰ˆæœ¬ï¼š** v1.0.0  
---

## ğŸ“– é¡¹ç›®æ¦‚è¿°
---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### å‰ç«¯æŠ€æœ¯
- **æ¡†æ¶**ï¼šReact 18 + TypeScript 5.0
- **æ„å»ºå·¥å…·**ï¼šUmiJS 4.6 (Ant Design Pro Max)
- **UI ç»„ä»¶åº“**ï¼šAnt Design 5.4 + Pro Components 2.8
- **æ ·å¼æ–¹æ¡ˆ**ï¼šTailwind CSS 3.4 + Less
- **åŒ…ç®¡ç†å™¨**ï¼špnpm 10.26

### å¼€å‘å·¥å…·
- **ä»£ç æ ¼å¼åŒ–**ï¼šPrettier
- **ç±»å‹æ£€æŸ¥**ï¼šTypeScript
- **Git Hooks**ï¼šlint-staged

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
network/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Proxy/          # è®¿é—®ç®¡ç†é¡µé¢
â”‚   â”‚   â”œâ”€â”€ Device/         # è®¾å¤‡ç®¡ç†é¡µé¢
â”‚   â”‚   â”œâ”€â”€ Connector/      # è¿æ¥å™¨ç®¡ç†é¡µé¢
â”‚   â”‚   â”œâ”€â”€ App/            # åº”ç”¨ç®¡ç†é¡µé¢
â”‚   â”‚   â”œâ”€â”€ Login/          # ç™»å½•é¡µé¢
â”‚   â”‚   â””â”€â”€ Settings/       # è®¾ç½®é¡µé¢
â”‚   â”œâ”€â”€ services/           # API æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ api.ts          # API æ¥å£å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.ts        # æœåŠ¡å¯¼å‡º
â”‚   â”œâ”€â”€ components/         # å…¬å…±ç»„ä»¶
â”‚   â”‚   â””â”€â”€ TableButtons/   # è¡¨æ ¼æŒ‰é’®ç»„ä»¶
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ request.ts      # è¯·æ±‚å°è£…
â”‚   â”‚   â”œâ”€â”€ format.ts       # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚   â””â”€â”€ tableConfig.ts  # è¡¨æ ¼é…ç½®
â”‚   â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ constants/          # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ assets/             # é™æ€èµ„æº
â”‚   â”œâ”€â”€ app.ts              # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ access.ts           # æƒé™é…ç½®
â”‚   â””â”€â”€ typings.d.ts        # ç±»å‹å®šä¹‰
â”œâ”€â”€ .umirc.ts               # UmiJS é…ç½®
â”œâ”€â”€ tailwind.config.js      # Tailwind é…ç½®
â”œâ”€â”€ package.json            # ä¾èµ–é…ç½®
â””â”€â”€ tsconfig.json           # TS é…ç½®
```

---

## ğŸŒ åŠŸèƒ½æ¨¡å—è¯´æ˜

### 1. è®¿é—®ç®¡ç†
- åˆ›å»ºå…¬ç½‘è®¿é—®ï¼Œæ˜ å°„åˆ°å†…ç½‘åº”ç”¨
- æ”¯æŒ TCP/UDP åè®®
- æŸ¥çœ‹è®¿é—®çŠ¶æ€å’Œå…³è”åº”ç”¨
- å¤åˆ¶å…¬ç½‘è®¿é—®ä¿¡æ¯

### 2. è®¾å¤‡ç®¡ç†
- æŸ¥çœ‹è®¾å¤‡åˆ—è¡¨ï¼ˆæ“ä½œç³»ç»Ÿã€CPUã€å†…å­˜ã€ç£ç›˜ï¼‰
- å±•ç¤ºè®¾å¤‡ç½‘å¡ä¿¡æ¯ï¼ˆåç§°ã€IPã€MACï¼‰
- æŒ‰è®¾å¤‡åæˆ–ç½‘å¡ IP æœç´¢
- æŸ¥çœ‹è®¾å¤‡è¯¦æƒ…

### 3. è¿æ¥å™¨ç®¡ç†
- åˆ›å»ºè¿æ¥å™¨å¹¶è·å–å®‰è£…å‘½ä»¤
- æŸ¥çœ‹è¿æ¥å™¨åœ¨çº¿çŠ¶æ€å’Œè¿è¡ŒçŠ¶æ€
- æ‰«æå†…ç½‘åº”ç”¨
- å…³è”è®¾å¤‡ï¼ŒæŒ‰è®¾å¤‡åæœç´¢

### 4. åº”ç”¨ç®¡ç†
- æ³¨å†Œå†…ç½‘åº”ç”¨ï¼ˆSSHã€Webã€æ•°æ®åº“ç­‰ï¼‰
- æŸ¥çœ‹åº”ç”¨å…³è”çš„è®¿é—®
- å¿«é€Ÿåˆ›å»ºè®¿é—®
- æŒ‰åº”ç”¨åæˆ–è®¾å¤‡åæœç´¢

### 5. ç”¨æˆ·ç®¡ç†
- ç”¨æˆ·ç™»å½•/ç™»å‡º
- ä¿®æ”¹å¯†ç 
- JWT Token è‡ªåŠ¨ç»­æœŸå’Œå¤±æ•ˆå¤„ç†

---

## ğŸ”Œ åç«¯ API æ¥å£æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯
- **Base URL**: `http://49.232.250.11:8080`
- **API Prefix**: `/api/v1`
- **è®¤è¯æ–¹å¼**: Bearer Token (JWT)
- **å“åº”æ ¼å¼**: JSON

### é€šç”¨å“åº”ç»“æ„
```typescript
{
  code: number;       // 200: æˆåŠŸ, 401: æœªæˆæƒ, 500: æœåŠ¡å™¨é”™è¯¯
  message: string;    // å“åº”æ¶ˆæ¯
  data?: any;         // å“åº”æ•°æ®
}
```

---

### 1. è®¤è¯æ¥å£ (IAM)

#### 1.1 ç™»å½•
```
POST /api/v1/iam/login
Content-Type: application/json

Request:
{
  "email": "string",
  "password": "string"
}

Response:
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "string",
    "user": {
      "id": number,
      "email": "string",
      "name": "string"
    }
  }
}
```

#### 1.2 è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
```
GET /api/v1/iam/profile
Authorization: Bearer <token>

Response:
{
  "code": 200,
  "data": {
    "id": number,
    "email": "string",
    "name": "string"
  }
}
```

#### 1.3 ä¿®æ”¹å¯†ç 
```
PUT /api/v1/iam/user/password
Authorization: Bearer <token>

Request:
{
  "old_password": "string",
  "new_password": "string"
}
```

#### 1.4 ç™»å‡º
```
POST /api/v1/iam/logout
Authorization: Bearer <token>
```

---

### 2. è®¿é—®æ¥å£ (Proxies)

#### 2.1 è·å–è®¿é—®åˆ—è¡¨
```
GET /api/v1/proxies?page=1&page_size=20&name=<search>
Authorization: Bearer <token>

Response:
{
  "code": 200,
  "data": {
    "proxies": [
      {
        "id": number,
        "name": "string",
        "description": "string",
        "port": number,              // å…¬ç½‘ç«¯å£
        "application_id": number,
        "application_name": "string",
        "application_ip": "string",  // å†…ç½‘åº”ç”¨ IP
        "application_port": number,  // å†…ç½‘åº”ç”¨ç«¯å£
        "device_name": "string",     // æ‰€å±è®¾å¤‡å
        "status": number,            // 1: running, 2: stopped
        "created_at": "string",
        "updated_at": "string"
      }
    ],
    "total": number
  }
}
```

#### 2.2 åˆ›å»ºè®¿é—®
```
POST /api/v1/proxies
Authorization: Bearer <token>

Request:
{
  "name": "string",
  "description": "string",
  "port": number,
  "application_id": number
}

Response:
{
  "code": 200,
  "data": {
    "id": number,
    "name": "string",
    "port": number,
    ...
  }
}
```

#### 2.3 æ›´æ–°è®¿é—®
```
PUT /api/v1/proxies/:id
Authorization: Bearer <token>

Request:
{
  "name": "string",
  "description": "string",
  "status": number
}
```

#### 2.4 åˆ é™¤è®¿é—®
```
DELETE /api/v1/proxies/:id
Authorization: Bearer <token>
```

---

### 3. è®¾å¤‡æ¥å£ (Devices)

#### 3.1 è·å–è®¾å¤‡åˆ—è¡¨
```
GET /api/v1/devices?page=1&page_size=20&name=<search>&ip=<ip_search>
Authorization: Bearer <token>

Query Parameters:
- name: è®¾å¤‡åæœç´¢
- ip: ç½‘å¡ IP æœç´¢

Response:
{
  "code": 200,
  "data": {
    "devices": [
      {
        "id": number,
        "name": "string",
        "description": "string",
        "os": "string",              // linux/windows/macos
        "version": "string",
        "cpu": number,
        "memory": number,            // MB
        "disk": number,              // MB
        "interfaces": [              // ç½‘å¡ä¿¡æ¯
          {
            "name": "string",        // eth0, ens33
            "mac": "string",
            "ip": ["string"]         // IP åœ°å€åˆ—è¡¨
          }
        ],
        "created_at": "string",
        "updated_at": "string"
      }
    ],
    "total": number
  }
}
```

#### 3.2 è·å–è®¾å¤‡è¯¦æƒ…
```
GET /api/v1/devices/:id
Authorization: Bearer <token>

Response: åŒè®¾å¤‡å¯¹è±¡ç»“æ„
```

#### 3.3 æ›´æ–°è®¾å¤‡
```
PUT /api/v1/devices/:id
Authorization: Bearer <token>

Request:
{
  "name": "string",
  "description": "string"
}
```

---

### 4. è¿æ¥å™¨æ¥å£ (Edges)

#### 4.1 è·å–è¿æ¥å™¨åˆ—è¡¨
```
GET /api/v1/edges?page=1&page_size=20&name=<search>&device_name=<device_search>
Authorization: Bearer <token>

Query Parameters:
- name: è¿æ¥å™¨åæœç´¢
- device_name: è®¾å¤‡åæœç´¢

Response:
{
  "code": 200,
  "data": {
    "edges": [
      {
        "id": number,
        "name": "string",
        "description": "string",
        "status": number,            // 1: running, 2: stopped
        "online": number,            // 0: offline, 1: online
        "device_id": number,
        "device_name": "string",     // æ‰€å±è®¾å¤‡å
        "created_at": "string",
        "updated_at": "string"
      }
    ],
    "total": number
  }
}
```

#### 4.2 åˆ›å»ºè¿æ¥å™¨
```
POST /api/v1/edges
Authorization: Bearer <token>

Request:
{
  "name": "string",
  "description": "string"
}

Response:
{
  "code": 200,
  "data": {
    "access_key": "string",
    "secret_key": "string",
    "command": "string"            // å®‰è£…å‘½ä»¤ï¼ˆé‡è¦ï¼šå­—æ®µåä¸º commandï¼‰
  }
}
```

#### 4.3 æ›´æ–°è¿æ¥å™¨
```
PUT /api/v1/edges/:id
Authorization: Bearer <token>

Request:
{
  "name": "string",
  "description": "string",
  "status": number
}
```

#### 4.4 åˆ é™¤è¿æ¥å™¨
```
DELETE /api/v1/edges/:id
Authorization: Bearer <token>
```

#### 4.5 æ‰«æåº”ç”¨
```
POST /api/v1/edges/:id/scan
Authorization: Bearer <token>

Response:
{
  "code": 200,
  "data": {
    "task_id": "string"
  }
}
```

#### 4.6 è·å–æ‰«æä»»åŠ¡çŠ¶æ€
```
GET /api/v1/edges/:id/scan/:task_id
Authorization: Bearer <token>

Response:
{
  "code": 200,
  "data": {
    "task_id": "string",
    "task_status": "string",       // pending, running, completed, failed
    "applications": ["string"],
    "error": "string"
  }
}
```

---

### 5. åº”ç”¨æ¥å£ (Applications)

#### 5.1 è·å–åº”ç”¨åˆ—è¡¨
```
GET /api/v1/applications?page=1&page_size=20&name=<search>&device_name=<device_search>
Authorization: Bearer <token>

Query Parameters:
- name: åº”ç”¨åæœç´¢
- device_name: è®¾å¤‡åæœç´¢

Response:
{
  "code": 200,
  "data": {
    "applications": [
      {
        "id": number,
        "name": "string",
        "application_type": "string",  // ssh, tcp, web, etc.
        "ip": "string",
        "port": number,
        "edge_id": number,
        "device": {
          "id": number,
          "name": "string"
        },
        "proxy_name": "string",        // å…³è”çš„è®¿é—®åç§°
        "proxy_port": number,          // å…³è”çš„è®¿é—®ç«¯å£
        "created_at": "string",
        "updated_at": "string"
      }
    ],
    "total": number
  }
}
```

#### 5.2 åˆ›å»ºåº”ç”¨
```
POST /api/v1/applications
Authorization: Bearer <token>

Request:
{
  "name": "string",
  "application_type": "string",
  "ip": "string",
  "port": number,
  "edge_id": number,
  "device_id": number
}
```

#### 5.3 æ›´æ–°åº”ç”¨
```
PUT /api/v1/applications/:id
Authorization: Bearer <token>

Request:
{
  "name": "string"
}
```

#### 5.4 åˆ é™¤åº”ç”¨
```
DELETE /api/v1/applications/:id
Authorization: Bearer <token>
```

---

## ğŸš€ éƒ¨ç½²è¯´æ˜

### å¼€å‘ç¯å¢ƒéƒ¨ç½²

#### 1. ç¯å¢ƒè¦æ±‚
- Node.js >= 16.x
- pnpm >= 8.x
- ç°ä»£æµè§ˆå™¨ï¼ˆChrome/Firefox/Edge æœ€æ–°ç‰ˆï¼‰

#### 2. å®‰è£…ä¾èµ–
```bash
cd /d/work/demome/network
pnpm install
```

#### 3. é…ç½®åç«¯åœ°å€
ç¼–è¾‘ `.umirc.ts`ï¼Œä¿®æ”¹ proxy é…ç½®ï¼š
```typescript
proxy: {
  '/api': {
    target: 'http://your-backend-server:8080',
    changeOrigin: true,
  },
}
```

#### 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
pnpm dev
# æˆ–
pnpm start
```

è®¿é—®ï¼šhttp://localhost:8000

---

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### 1. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
```bash
pnpm build
```

æ„å»ºäº§ç‰©ä½äº `dist/` ç›®å½•ã€‚

#### 2. éƒ¨ç½²åˆ° Nginx

**Nginx é…ç½®ç¤ºä¾‹ï¼š**
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/liaison/dist;
        try_files $uri $uri/ /index.html;
        index index.html;
    }
    
    # è®¿é—®åç«¯ API
    location /api/ {
        proxy_pass http://49.232.250.11:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # Gzip å‹ç¼©
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
}
```

#### 3. éƒ¨ç½²æ­¥éª¤
```bash
# 1. ä¸Šä¼ æ„å»ºäº§ç‰©
scp -r dist/* user@server:/var/www/liaison/dist/

# 2. é‡å¯ Nginx
sudo nginx -t
sudo systemctl reload nginx
```

#### 4. Docker éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

**Dockerfile ç¤ºä¾‹ï¼š**
```dockerfile
FROM nginx:alpine

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY dist/ /usr/share/nginx/html/

# å¤åˆ¶ Nginx é…ç½®
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

**æ„å»ºå’Œè¿è¡Œï¼š**
```bash
docker build -t liaison-frontend .
docker run -d -p 80:80 liaison-frontend
```

---

## âš™ï¸ ç¯å¢ƒå˜é‡é…ç½®

å‰ç«¯åº”ç”¨é€šè¿‡ `.umirc.ts` é…ç½®ç¯å¢ƒå˜é‡ï¼š

```typescript
export default defineConfig({
  define: {
    API_BASE_URL: process.env.API_BASE_URL || 'http://49.232.250.11:8080',
  },
  proxy: {
    '/api': {
      target: process.env.API_BASE_URL || 'http://49.232.250.11:8080',
      changeOrigin: true,
    },
  },
});
```

**æ„å»ºæ—¶æŒ‡å®šç¯å¢ƒå˜é‡ï¼š**
```bash
API_BASE_URL=https://api.production.com pnpm build
```

---

## ğŸ”’ å®‰å…¨è¯´æ˜

### è®¤è¯æœºåˆ¶
- ä½¿ç”¨ JWT Token è¿›è¡Œç”¨æˆ·è®¤è¯
- Token å­˜å‚¨åœ¨ localStorage
- Token å¤±æ•ˆï¼ˆ401ï¼‰è‡ªåŠ¨è·³è½¬ç™»å½•é¡µ
- è¯·æ±‚æ‹¦æˆªå™¨è‡ªåŠ¨æ·»åŠ  Authorization å¤´

### æƒé™æ§åˆ¶
- æœªç™»å½•ç”¨æˆ·è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ
- æ”¯æŒåŸºäºè·¯ç”±çš„æƒé™æ§åˆ¶
- æ•æ„Ÿæ“ä½œéœ€è¦äºŒæ¬¡ç¡®è®¤

### å®‰å…¨å»ºè®®
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ HTTPS
- å®šæœŸæ›´æ¢ JWT Secret
- è®¾ç½®åˆç†çš„ Token è¿‡æœŸæ—¶é—´
- å¯ç”¨ CORS ç™½åå•
- é…ç½® CSP ç­–ç•¥

---

## ğŸ“Š ç›‘æ§å’Œè¿ç»´

### æ€§èƒ½ç›‘æ§
- ä½¿ç”¨æµè§ˆå™¨ DevTools ç›‘æ§æ€§èƒ½
- å…³æ³¨é¦–å±åŠ è½½æ—¶é—´å’Œèµ„æºå¤§å°
- å®šæœŸæ£€æŸ¥æ§åˆ¶å°é”™è¯¯

### æ—¥å¿—è®°å½•
- å‰ç«¯é”™è¯¯è‡ªåŠ¨ä¸ŠæŠ¥ï¼ˆå¯é…ç½®ï¼‰
- æŸ¥çœ‹ Network é¢æ¿æ’æŸ¥ API é—®é¢˜
- ä½¿ç”¨ Redux DevTools è°ƒè¯•çŠ¶æ€

### å¸¸è§é—®é¢˜æ’æŸ¥

#### 1. ç™»å½•å¤±è´¥
- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸
- éªŒè¯ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

#### 2. API è¯·æ±‚å¤±è´¥
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- éªŒè¯ Token æ˜¯å¦æœ‰æ•ˆ
- æŸ¥çœ‹åç«¯æ—¥å¿—

#### 3. é¡µé¢åŠ è½½ç¼“æ…¢
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- æ£€æŸ¥ç½‘ç»œå¸¦å®½
- ä½¿ç”¨ CDN åŠ é€Ÿé™æ€èµ„æº


## ğŸ“„ é™„å½•

### A. æµè§ˆå™¨å…¼å®¹æ€§
- Chrome >= 90
- Firefox >= 88
- Edge >= 90
- Safari >= 14

### B. ç¬¬ä¸‰æ–¹ä¾èµ–
- è¯¦è§ `package.json`
- å®šæœŸæ›´æ–°ä¾èµ–ä»¥ä¿®å¤å®‰å…¨æ¼æ´
- ä½¿ç”¨ `pnpm audit` æ£€æŸ¥å®‰å…¨é—®é¢˜

### C. ç‰ˆæœ¬å†å²
- **v1.0.0** (2026-01-08): åˆå§‹ç‰ˆæœ¬å‘å¸ƒ

---

*æœ¬æ–‡æ¡£åŒ…å«äº† Liaison ç³»ç»Ÿçš„å®Œæ•´éƒ¨ç½²å’Œ API è¯´æ˜ï¼Œå¦‚æœ‰ç–‘é—®è¯·è”ç³»æŠ€æœ¯æ”¯æŒã€‚*
