# Liaison Web é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“ é¡¹ç›®æ¦‚è§ˆ

è¿™æ˜¯ä¸€ä¸ªåŸºäº **UmiJS Max** + **React** + **TypeScript** + **Ant Design Pro** çš„å‰ç«¯é¡¹ç›®ã€‚

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: UmiJS Max 4.x (åŸºäº React 18)
- **UIç»„ä»¶åº“**: Ant Design 5.x + Ant Design Pro Components
- **è¯­è¨€**: TypeScript 5.x
- **çŠ¶æ€ç®¡ç†**: UmiJS å†…ç½®çŠ¶æ€ç®¡ç†
- **HTTPå®¢æˆ·ç«¯**: UmiJS Request (åŸºäº axios)
- **åŒ…ç®¡ç†å™¨**: pnpm

---

## ğŸ“‚ ç›®å½•ç»“æ„è¯¦è§£

```
web/
â”œâ”€â”€ config/                 # UmiJS é…ç½®æ–‡ä»¶ç›®å½•
â”œâ”€â”€ mock/                   # Mock æ•°æ®ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ pages/             # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ components/        # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ layouts/           # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ services/          # API æœåŠ¡å±‚
â”‚   â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ constants/         # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ assets/            # é™æ€èµ„æº
â”‚   â”œâ”€â”€ access.ts          # æƒé™æ§åˆ¶
â”‚   â””â”€â”€ app.tsx            # åº”ç”¨å…¥å£é…ç½®
â”œâ”€â”€ package.json           # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ tsconfig.json          # TypeScript é…ç½®
â””â”€â”€ typings.d.ts           # ç±»å‹å£°æ˜æ–‡ä»¶
```

---

## ğŸ“‹ è¯¦ç»†è¯´æ˜

### 1. `/config` - é…ç½®æ–‡ä»¶ç›®å½•

#### `routes.ts`
- **ä½œç”¨**: å®šä¹‰åº”ç”¨çš„è·¯ç”±é…ç½®
- **å†…å®¹**: 
  - ç™»å½•é¡µ (`/login`)
  - é¦–é¡µ (`/home`) - ä»£ç†ç®¡ç†
  - åº”ç”¨/è®¾å¤‡ (`/device`) - åŒ…å«åº”ç”¨åˆ—è¡¨å’Œè®¾å¤‡åˆ—è¡¨
  - è¿æ¥å™¨ (`/access`)
  - è®¾ç½® (`/table`)
  - ä¸ªäººä¸­å¿ƒ (`/profile`)
  - è´¦æˆ·ç®¡ç† (`/users`)

#### `proxy.ts`
- **ä½œç”¨**: å¼€å‘ç¯å¢ƒ API ä»£ç†é…ç½®
- **å½“å‰é…ç½®**: 
  - `/v1` å’Œ `/api` è¯·æ±‚ä»£ç†åˆ° `http://localhost:8080`
  - ç”¨äºè§£å†³å¼€å‘ç¯å¢ƒçš„è·¨åŸŸé—®é¢˜

#### `defaultSettings.ts`
- **ä½œç”¨**: Ant Design Pro çš„é»˜è®¤ä¸»é¢˜å’Œå¸ƒå±€é…ç½®

#### `theme.config.ts`
- **ä½œç”¨**: ä¸»é¢˜æ ·å¼é…ç½®

---

### 2. `/src` - æºä»£ç ç›®å½•

#### `/src/pages` - é¡µé¢ç»„ä»¶

æŒ‰ä¸šåŠ¡æ¨¡å—ç»„ç»‡çš„é¡µé¢ç»„ä»¶ï¼š

- **`Login/`** - ç™»å½•é¡µé¢
  - `index.tsx` - ç™»å½•è¡¨å•å’Œé€»è¾‘

- **`Home/`** - é¦–é¡µï¼ˆä»£ç†ç®¡ç†ï¼‰
  - `index.tsx` - ä»£ç†åˆ—è¡¨é¡µé¢
  - `index.less` - æ ·å¼æ–‡ä»¶

- **`AppList/`** - åº”ç”¨åˆ—è¡¨
  - `index.tsx` - åº”ç”¨ç®¡ç†é¡µé¢
  - `index.less` - æ ·å¼æ–‡ä»¶

- **`Device/`** - è®¾å¤‡ç®¡ç†
  - `index.tsx` - è®¾å¤‡åˆ—è¡¨é¡µé¢
  - `index.less` - æ ·å¼æ–‡ä»¶

- **`Access/`** - è¿æ¥å™¨ç®¡ç†
  - `index.tsx` - è¿æ¥å™¨é¡µé¢

- **`Profile/`** - ä¸ªäººä¸­å¿ƒ
  - `index.tsx` - ä¸ªäººèµ„æ–™é¡µé¢
  - `components/` - å­ç»„ä»¶
    - `ChangePasswordModal.tsx` - ä¿®æ”¹å¯†ç å¼¹çª—
    - `EditProfileModal.tsx` - ç¼–è¾‘èµ„æ–™å¼¹çª—

- **`UserManagement/`** - ç”¨æˆ·ç®¡ç†ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰
  - `index.tsx` - ç”¨æˆ·åˆ—è¡¨é¡µé¢
  - `components/` - å­ç»„ä»¶
    - `UserFormModal.tsx` - ç”¨æˆ·è¡¨å•å¼¹çª—
    - `ChangeUserPasswordModal.tsx` - ä¿®æ”¹ç”¨æˆ·å¯†ç å¼¹çª—

- **`Table/`** - è®¾ç½®é¡µé¢
  - `index.tsx` - è®¾ç½®é¡µé¢
  - `components/` - å­ç»„ä»¶
    - `CreateForm.tsx` - åˆ›å»ºè¡¨å•
    - `UpdateForm.tsx` - æ›´æ–°è¡¨å•

---

#### `/src/services` - API æœåŠ¡å±‚

æŒ‰ä¸šåŠ¡æ¨¡å—ç»„ç»‡çš„ API è°ƒç”¨ï¼š

- **`iam/`** - èº«ä»½è®¤è¯ç®¡ç†
  - `index.ts` - IAM API æ–¹æ³•ï¼ˆç™»å½•ã€ç™»å‡ºã€ç”¨æˆ·ä¿¡æ¯ç­‰ï¼‰
  - `iam.d.ts` - TypeScript ç±»å‹å®šä¹‰

- **`applications/`** - åº”ç”¨ç®¡ç†
  - `index.ts` - åº”ç”¨ç›¸å…³ API
  - `applications.d.ts` - ç±»å‹å®šä¹‰

- **`devices/`** - è®¾å¤‡ç®¡ç†
  - `index.ts` - è®¾å¤‡ç›¸å…³ API
  - `devices.d.ts` - ç±»å‹å®šä¹‰

- **`edges/`** - è¾¹ç¼˜èŠ‚ç‚¹ç®¡ç†
  - `index.ts` - è¾¹ç¼˜èŠ‚ç‚¹ç›¸å…³ API
  - `edges.d.ts` - ç±»å‹å®šä¹‰

- **`proxies/`** - ä»£ç†ç®¡ç†
  - `index.ts` - ä»£ç†ç›¸å…³ API
  - `proxies.d.ts` - ç±»å‹å®šä¹‰

- **`api/`** - è‡ªåŠ¨ç”Ÿæˆçš„ APIï¼ˆOneAPIï¼‰
  - `UserController.ts` - ç”¨æˆ·æ§åˆ¶å™¨
  - `typings.d.ts` - ç±»å‹å®šä¹‰

- **`request.ts`** - HTTP è¯·æ±‚å°è£…
  - ç»Ÿä¸€çš„è¯·æ±‚æ‹¦æˆªå™¨ï¼ˆæ·»åŠ  tokenï¼‰
  - ç»Ÿä¸€çš„å“åº”æ‹¦æˆªå™¨ï¼ˆé”™è¯¯å¤„ç†ï¼‰
  - URL å‚æ•°è§£æå’Œè·¯å¾„å˜é‡æ›¿æ¢

---

#### `/src/components` - å…¬å…±ç»„ä»¶

- **`Guide/`** - å¼•å¯¼ç»„ä»¶
- **`PageHeader/`** - é¡µé¢å¤´éƒ¨ç»„ä»¶

---

#### `/src/layouts` - å¸ƒå±€ç»„ä»¶

- **`BasicLayout/`** - åŸºç¡€å¸ƒå±€ï¼ˆä¾§è¾¹æ  + å†…å®¹åŒºï¼‰
- **`HeaderRender/`** - å¤´éƒ¨æ¸²æŸ“ç»„ä»¶
- **`RightContent/`** - å³ä¾§å†…å®¹ï¼ˆç”¨æˆ·ä¿¡æ¯ç­‰ï¼‰

---

#### `/src/hooks` - è‡ªå®šä¹‰ Hooks

- **`useTableRequest.ts`** - è¡¨æ ¼è¯·æ±‚ Hookï¼ˆåˆ†é¡µã€æœç´¢ç­‰ï¼‰
- **`useQueryParams.ts`** - URL æŸ¥è¯¢å‚æ•°ç®¡ç† Hook

---

#### `/src/utils` - å·¥å…·å‡½æ•°

- **`format.ts`** - æ ¼å¼åŒ–å·¥å…·å‡½æ•°

---

#### `/src/models` - æ•°æ®æ¨¡å‹

- **`global.ts`** - å…¨å±€çŠ¶æ€æ¨¡å‹

---

#### `/src/constants` - å¸¸é‡å®šä¹‰

- **`index.ts`** - åº”ç”¨å¸¸é‡ï¼ˆå¦‚é»˜è®¤åç§°ç­‰ï¼‰

---

#### `/src/assets` - é™æ€èµ„æº

- **`icons/`** - å›¾æ ‡èµ„æº

---

#### `/src/access.ts`
- **ä½œç”¨**: æƒé™æ§åˆ¶é…ç½®
- **åŠŸèƒ½**: å®šä¹‰è·¯ç”±è®¿é—®æƒé™

---

#### `/src/app.tsx`
- **ä½œç”¨**: UmiJS åº”ç”¨å…¥å£é…ç½®
- **åŠŸèƒ½**:
  - `getInitialState` - åˆå§‹åŒ–å…¨å±€çŠ¶æ€ï¼ˆç”¨æˆ·ä¿¡æ¯ç­‰ï¼‰
  - `layout` - å¸ƒå±€é…ç½®
  - `request` - è¯·æ±‚é…ç½®ï¼ˆæ‹¦æˆªå™¨ã€é”™è¯¯å¤„ç†ï¼‰

---

### 3. `/mock` - Mock æ•°æ®

- **`userAPI.ts`** - Mock API æ•°æ®
  - ç”¨äºå¼€å‘æ—¶æ¨¡æ‹Ÿåç«¯æ¥å£
  - åŒ…å«ç”¨æˆ·ã€åº”ç”¨ã€IAM ç­‰æ¥å£çš„æ¨¡æ‹Ÿæ•°æ®
  - **æ³¨æ„**: ç”Ÿäº§ç¯å¢ƒåº”ç¦ç”¨ mockï¼Œè¿æ¥çœŸå®åç«¯

---

### 4. æ ¹ç›®å½•æ–‡ä»¶

- **`package.json`** - é¡¹ç›®ä¾èµ–å’Œè„šæœ¬é…ç½®
- **`tsconfig.json`** - TypeScript ç¼–è¯‘é…ç½®
- **`typings.d.ts`** - å…¨å±€ç±»å‹å£°æ˜
- **`global.less`** - å…¨å±€æ ·å¼

---

## ğŸ”„ æ•°æ®æµå‘

```
ç”¨æˆ·æ“ä½œ
  â†“
é¡µé¢ç»„ä»¶ (pages/)
  â†“
API æœåŠ¡ (services/)
  â†“
HTTP è¯·æ±‚å°è£… (request.ts)
  â†“
åç«¯ API (http://localhost:8080)
```

---

## ğŸš€ å¼€å‘æµç¨‹

### 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
cd web
pnpm install    # å®‰è£…ä¾èµ–
pnpm run dev    # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```

### 2. æ·»åŠ æ–°é¡µé¢
1. åœ¨ `/src/pages` åˆ›å»ºæ–°é¡µé¢ç»„ä»¶
2. åœ¨ `/config/routes.ts` æ·»åŠ è·¯ç”±é…ç½®
3. åœ¨ `/src/services` æ·»åŠ å¯¹åº”çš„ API æœåŠ¡

### 3. æ·»åŠ æ–° API
1. åœ¨å¯¹åº”çš„ `/src/services/{module}/index.ts` æ·»åŠ  API æ–¹æ³•
2. åœ¨ `/src/services/{module}/{module}.d.ts` æ·»åŠ ç±»å‹å®šä¹‰
3. åœ¨é¡µé¢ç»„ä»¶ä¸­è°ƒç”¨ API

---

## âš™ï¸ é…ç½®è¯´æ˜

### API ä»£ç†é…ç½®
- **å¼€å‘ç¯å¢ƒ**: é€šè¿‡ `config/proxy.ts` é…ç½®ä»£ç†åˆ° `http://localhost:8080`
- **ç”Ÿäº§ç¯å¢ƒ**: éœ€è¦é…ç½® Nginx åå‘ä»£ç†æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡

### Mock æ•°æ®
- **å¯ç”¨**: ä¿ç•™ `/mock` ç›®å½•ï¼ŒUmiJS ä¼šè‡ªåŠ¨å¯ç”¨
- **ç¦ç”¨**: åˆ é™¤æˆ–é‡å‘½å `/mock` ç›®å½•ä¸º `/mock.disabled`

### è®¤è¯æœºåˆ¶
- Token å­˜å‚¨åœ¨ `localStorage` ä¸­
- è¯·æ±‚è‡ªåŠ¨åœ¨ Header ä¸­æ·»åŠ  `Authorization: Bearer {token}`
- 401 é”™è¯¯è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **Mock vs çœŸå®åç«¯**
   - å¼€å‘æ—¶å¯ä»¥ä½¿ç”¨ mock æ•°æ®å¿«é€Ÿå¼€å‘
   - è¿æ¥çœŸå®åç«¯æ—¶éœ€è¦ç¦ç”¨ mock å¹¶é…ç½®æ­£ç¡®çš„ä»£ç†

2. **API è·¯å¾„**
   - æ‰€æœ‰ API è·¯å¾„ä»¥ `/v1` å¼€å¤´
   - é€šè¿‡ `request.ts` ç»Ÿä¸€å¤„ç†è·¯å¾„å’Œå‚æ•°

3. **ç±»å‹å®‰å…¨**
   - æ‰€æœ‰ API éƒ½æœ‰å¯¹åº”çš„ TypeScript ç±»å‹å®šä¹‰
   - å»ºè®®ä¿æŒç±»å‹å®šä¹‰ä¸åç«¯æ¥å£ä¸€è‡´

4. **è·¯ç”±é…ç½®**
   - è·¯ç”±åœ¨ `config/routes.ts` ä¸­é›†ä¸­ç®¡ç†
   - æ”¯æŒåµŒå¥—è·¯ç”±å’Œè·¯ç”±é‡å®šå‘

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [UmiJS æ–‡æ¡£](https://umijs.org/)
- [Ant Design Pro æ–‡æ¡£](https://pro.ant.design/)
- [React æ–‡æ¡£](https://react.dev/)
- [TypeScript æ–‡æ¡£](https://www.typescriptlang.org/)
