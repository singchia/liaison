<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liaison 管理平台</title>
    <script src="https://unpkg.com/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: rgba(0, 0, 0, 0.85);
            line-height: 1.6;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        /* 左侧导航栏 */
        .sidebar {
            width: 220px;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            box-shadow: 4px 0px 20px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            border-radius: 0 20px 20px 0;
            margin: 10px 0 10px 10px;
        }
        
        .logo-section {
            padding: 30px 32px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .logo {
            color: #FFFFFF;
            font-size: 20px;
            font-weight: 700;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .nav-menu {
            flex: 1;
            padding: 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0 20px;
            height: 48px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 15px;
            border-radius: 0 24px 24px 0;
            margin: 2px 0;
            position: relative;
            overflow: hidden;
        }
        
        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            transition: width 0.3s ease;
        }
        
        .nav-item:hover::before {
            width: 100%;
        }
        
        .nav-item:hover {
            color: #FFFFFF;
            transform: translateX(5px);
        }
        
        .nav-item.active {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: #FFFFFF;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .nav-item .nav-icon {
            width: 16px;
            height: 16px;
            margin-right: 12px;
            opacity: 0.7;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            line-height: 16px;
        }
        
        .nav-item.active .nav-icon {
            opacity: 1;
        }
        
        .nav-submenu {
            padding-left: 42px;
            font-size: 14px;
        }
        
        .nav-submenu .nav-item {
            height: 40px;
        }
        
        /* 主内容区域 */
        .main-content {
            flex: 1;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            display: flex;
            flex-direction: column;
            margin: 10px 10px 10px 0;
            border-radius: 20px 0 0 20px;
            overflow: hidden;
        }
        
        /* 顶部搜索区域 */
        .search-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 28px;
            margin: 20px 20px 0 20px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .search-form {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }
        
        .search-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .search-label {
            font-size: 14px;
            color: rgba(0, 0, 0, 0.85);
            white-space: nowrap;
        }
        
        .search-input {
            width: 172px;
            height: 32px;
            border: 1px solid #D9D9D9;
            border-radius: 2px;
            padding: 0 12px;
            font-size: 14px;
        }
        
        .search-input::placeholder {
            color: rgba(0, 0, 0, 0.25);
        }
        
        .search-select {
            width: 76px;
            height: 32px;
            border: 1px solid #D9D9D9;
            border-radius: 2px;
            padding: 0 12px;
            font-size: 14px;
            background-color: #FFFFFF;
        }
        
        .search-buttons {
            display: flex;
            gap: 8px;
        }
        
        .btn {
            height: 32px;
            padding: 0 16px;
            border: 1px solid #D9D9D9;
            border-radius: 2px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #1890FF;
            color: #FFFFFF;
            border-color: #1890FF;
        }
        
        .btn-primary:hover {
            background-color: #40A9FF;
        }
        
        .btn-default {
            background-color: #FFFFFF;
            color: rgba(0, 0, 0, 0.65);
        }
        
        .btn-default:hover {
            background-color: #F5F5F5;
        }
        
        /* 面包屑导航 */
        .breadcrumb-section {
            background-color: #FFFFFF;
            padding: 16px 32px;
            margin: 0 24px;
            border-bottom: 1px solid #E9E9E9;
        }
        
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .breadcrumb-item {
            color: rgba(0, 0, 0, 0.45);
        }
        
        .breadcrumb-item.active {
            color: #1890FF;
        }
        
        .breadcrumb-separator {
            color: rgba(0, 0, 0, 0.45);
        }
        
        .page-title {
            font-size: 20px;
            font-weight: 500;
            color: rgba(0, 0, 0, 0.85);
            margin-top: 8px;
        }
        
        /* 表格区域 */
        .table-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            margin: 0 20px 20px 20px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .table-header {
            padding: 20px 28px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(248, 250, 252, 0.8));
        }
        
        .table-title {
            font-size: 16px;
            color: rgba(0, 0, 0, 0.85);
            opacity: 0.85;
        }
        
        .table-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-new {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #FFFFFF;
            border: none;
            height: 40px;
            padding: 0 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-new:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }
        
        /* 表格样式 */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background-color: #FAFAFA;
            color: rgba(0, 0, 0, 0.85);
            font-weight: 500;
            font-size: 14px;
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #E8E8E8;
        }
        
        .data-table td {
            padding: 12px 16px;
            font-size: 14px;
            color: rgba(0, 0, 0, 0.65);
            border-bottom: 1px solid #E8E8E8;
        }
        
        .data-table tr:hover {
            background-color: #F5F5F5;
        }
        
        .checkbox {
            width: 16px;
            height: 16px;
            border: 1px solid rgba(0, 0, 0, 0.15);
            border-radius: 2px;
            cursor: pointer;
        }
        
        .checkbox.checked {
            background-color: #1890FF;
            border-color: #1890FF;
            position: relative;
        }
        
        .checkbox.checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #FFFFFF;
            font-size: 12px;
        }
        
        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-dot.online {
            background-color: #52C41A;
        }
        
        .status-dot.offline {
            background-color: #1890FF;
        }
        
        .status-dot.error {
            background-color: #F5222D;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .btn-action {
            background: none;
            border: none;
            color: #1890FF;
            font-size: 14px;
            cursor: pointer;
            padding: 0;
        }
        
        .btn-action:hover {
            color: #40A9FF;
        }
        
        /* 批量操作栏 */
        .batch-actions {
            background-color: #E6F7FF;
            border: 1px solid #BAE7FF;
            padding: 9px 16px;
            margin: 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .batch-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .batch-count {
            color: rgba(0, 0, 0, 0.65);
            font-size: 14px;
        }
        
        .batch-summary {
            color: rgba(0, 0, 0, 0.65);
            font-size: 14px;
        }
        
        .batch-actions-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .btn-clear {
            background: none;
            border: none;
            color: #1890FF;
            font-size: 14px;
            cursor: pointer;
        }
        
        .btn-clear:hover {
            color: #40A9FF;
        }
        
        /* 分页 */
        .pagination-section {
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #FFFFFF;
            margin: 0 24px 24px 24px;
            border-radius: 2px;
        }
        
        .pagination-info {
            color: rgba(0, 0, 0, 0.65);
            font-size: 14px;
        }
        
        .pagination {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .pagination-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #D9D9D9;
            background-color: #FFFFFF;
            color: rgba(0, 0, 0, 0.65);
            border-radius: 2px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .pagination-btn:hover {
            border-color: #1890FF;
            color: #1890FF;
        }
        
        .pagination-btn.active {
            background-color: #1890FF;
            border-color: #1890FF;
            color: #FFFFFF;
        }
        
        .pagination-btn:disabled {
            background-color: #F5F5F5;
            color: rgba(0, 0, 0, 0.25);
            cursor: not-allowed;
        }
        
        .pagination-size {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 16px;
        }
        
        .pagination-jump {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 16px;
        }
        
        .pagination-input {
            width: 50px;
            height: 32px;
            border: 1px solid #D9D9D9;
            border-radius: 2px;
            text-align: center;
            font-size: 14px;
        }
        
        /* 响应式 */
        @media (max-width: 1200px) {
            .search-form {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .search-item {
                width: 100%;
                justify-content: space-between;
            }
            
            .search-input, .search-select {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="app-container">
            <!-- 左侧导航栏 -->
            <div class="sidebar">
                <div class="logo-section">
                    <div class="logo">Liaison</div>
                </div>
                <div class="nav-menu">
                    <button class="nav-item" :class="{ active: currentPage === 'proxy' }" @click="switchPage('proxy')">
                        <span class="nav-icon">Proxy</span>
                        代理
                    </button>
                    <button class="nav-item" :class="{ active: currentPage === 'application' }" @click="switchPage('application')">
                        <span class="nav-icon">App</span>
                        应用/设备
                    </button>
                    <div class="nav-submenu" v-if="currentPage === 'application'">
                        <button class="nav-item" :class="{ active: currentSubPage === 'application' }" @click="switchSubPage('application')">
                            应用
                        </button>
                        <button class="nav-item" :class="{ active: currentSubPage === 'device' }" @click="switchSubPage('device')">
                            设备
                        </button>
                    </div>
                    <button class="nav-item" :class="{ active: currentPage === 'connector' }" @click="switchPage('connector')">
                        <span class="nav-icon">Edge</span>
                        连接器
                    </button>
                </div>
            </div>
            
            <!-- 主内容区域 -->
            <div class="main-content">
                <!-- 搜索区域 -->
                <div class="search-section">
                    <div class="search-form">
                        <!-- 应用搜索表单 -->
                        <template v-if="currentPage === 'application' && currentSubPage === 'application'">
                            <div class="search-item">
                                <label class="search-label">应用名：</label>
                                <input type="text" class="search-input" placeholder="请输入应用名称" v-model="searchForm.name">
                            </div>
                            <div class="search-item">
                                <label class="search-label">协议：</label>
                                <select class="search-select" v-model="searchForm.protocol">
                                    <option value="">请选择</option>
                                    <option value="tcp">TCP</option>
                                    <option value="udp">UDP</option>
                                    <option value="http">HTTP</option>
                                </select>
                            </div>
                        </template>
                        
                        <!-- 设备搜索表单 -->
                        <template v-else-if="currentPage === 'application' && currentSubPage === 'device'">
                            <div class="search-item">
                                <label class="search-label">设备名：</label>
                                <input type="text" class="search-input" placeholder="请输入设备名称" v-model="searchForm.name">
                            </div>
                            <div class="search-item">
                                <label class="search-label">操作系统：</label>
                                <select class="search-select" v-model="searchForm.os">
                                    <option value="">请选择</option>
                                    <option value="Linux">Linux</option>
                                    <option value="Windows">Windows</option>
                                    <option value="macOS">macOS</option>
                                </select>
                            </div>
                        </template>
                        
                        <!-- 连接器搜索表单 -->
                        <template v-else-if="currentPage === 'connector'">
                            <div class="search-item">
                                <label class="search-label">连接器名：</label>
                                <input type="text" class="search-input" placeholder="请输入连接器名称" v-model="searchForm.name">
                            </div>
                            <div class="search-item">
                                <label class="search-label">状态：</label>
                                <select class="search-select" v-model="searchForm.status">
                                    <option value="">请选择</option>
                                    <option value="1">运行中</option>
                                    <option value="0">已停止</option>
                                </select>
                            </div>
                            <div class="search-item">
                                <label class="search-label">在线状态：</label>
                                <select class="search-select" v-model="searchForm.online">
                                    <option value="">请选择</option>
                                    <option value="1">在线</option>
                                    <option value="0">离线</option>
                                </select>
                            </div>
                        </template>
                        
                        <!-- 代理搜索表单 -->
                        <template v-else-if="currentPage === 'proxy'">
                            <div class="search-item">
                                <label class="search-label">代理名：</label>
                                <input type="text" class="search-input" placeholder="请输入代理名称" v-model="searchForm.name">
                            </div>
                            <div class="search-item">
                                <label class="search-label">状态：</label>
                                <select class="search-select" v-model="searchForm.status">
                                    <option value="">请选择</option>
                                    <option value="running">运行中</option>
                                    <option value="stopped">已停止</option>
                                </select>
                            </div>
                        </template>
                        
                        <div class="search-buttons">
                            <button class="btn btn-primary" @click="handleSearch">查询</button>
                            <button class="btn btn-default" @click="handleReset">重置</button>
                        </div>
                    </div>
                </div>
                
                <!-- 面包屑导航 -->
                <div class="breadcrumb-section">
                    <div class="breadcrumb">
                        <span class="breadcrumb-item">首页</span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item">列表页</span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item active">{{ getPageTitle() }}</span>
                    </div>
                    <div class="page-title">{{ getPageTitle() }}</div>
                </div>
                
                <!-- 批量操作栏 -->
                <div class="batch-actions" v-if="selectedItems.length > 0">
                    <div class="batch-info">
                        <span class="batch-count">已选择 {{ selectedItems.length }} 项</span>
                        <span class="batch-summary">服务调用总计：36.4 万</span>
                    </div>
                    <div class="batch-actions-right">
                        <button class="btn-clear" @click="clearSelection">清空</button>
                    </div>
                </div>
                
                <!-- 表格区域 -->
                <div class="table-section">
                    <div class="table-header">
                        <div class="table-title">{{ getPageTitle() }}</div>
                        <div class="table-actions">
                            <button class="btn-new" @click="handleNew">
                                <span>+</span>
                                新建
                            </button>
                        </div>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" class="checkbox" :checked="isAllSelected" @change="toggleSelectAll">
                                </th>
                                <!-- 应用列表表头 -->
                                <template v-if="currentPage === 'application' && currentSubPage === 'application'">
                                    <th>应用名称</th>
                                    <th>协议</th>
                                    <th>端口</th>
                                    <th>连接器</th>
                                    <th>状态</th>
                                    <th>更新时间</th>
                                </template>
                                <!-- 设备列表表头 -->
                                <template v-else-if="currentPage === 'application' && currentSubPage === 'device'">
                                    <th>设备名称</th>
                                    <th>描述</th>
                                    <th>CPU</th>
                                    <th>内存</th>
                                    <th>磁盘</th>
                                    <th>操作系统</th>
                                    <th>版本</th>
                                    <th>创建时间</th>
                                </template>
                                <!-- 连接器列表表头 -->
                                <template v-else-if="currentPage === 'connector'">
                                    <th>连接器名称</th>
                                    <th>描述</th>
                                    <th>状态</th>
                                    <th>在线状态</th>
                                    <th>创建时间</th>
                                </template>
                                <!-- 代理列表表头 -->
                                <template v-else-if="currentPage === 'proxy'">
                                    <th>代理名称</th>
                                    <th>端口</th>
                                    <th>状态</th>
                                    <th>关联应用</th>
                                    <th>描述</th>
                                    <th>创建时间</th>
                                </template>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="item in tableData" :key="item.id">
                                <td>
                                    <input type="checkbox" class="checkbox" :checked="selectedItems.includes(item.id)" @change="toggleSelect(item.id)">
                                </td>
                                
                                <!-- 应用列表数据 -->
                                <template v-if="currentPage === 'application' && currentSubPage === 'application'">
                                    <td>{{ item.name }}</td>
                                    <td>{{ item.application_type || 'TCP' }}</td>
                                    <td>{{ item.port }}</td>
                                    <td>{{ item.edge_id }}</td>
                                    <td>
                                        <span class="status-dot online"></span>
                                        运行中
                                    </td>
                                    <td>{{ item.updated_at }}</td>
                                </template>
                                
                                <!-- 设备列表数据 -->
                                <template v-else-if="currentPage === 'application' && currentSubPage === 'device'">
                                    <td>{{ item.name }}</td>
                                    <td>{{ item.description || '-' }}</td>
                                    <td>{{ item.cpu }}核</td>
                                    <td>{{ item.memory }}MB</td>
                                    <td>{{ item.disk }}GB</td>
                                    <td>{{ item.os }}</td>
                                    <td>{{ item.version }}</td>
                                    <td>{{ item.created_at }}</td>
                                </template>
                                
                                <!-- 连接器列表数据 -->
                                <template v-else-if="currentPage === 'connector'">
                                    <td>{{ item.name }}</td>
                                    <td>{{ item.description || '-' }}</td>
                                    <td>
                                        <span class="status-dot" :class="item.status === 1 ? 'online' : 'offline'"></span>
                                        {{ item.status === 1 ? '运行中' : '已停止' }}
                                    </td>
                                    <td>
                                        <span class="status-dot" :class="item.online === 1 ? 'online' : 'offline'"></span>
                                        {{ item.online === 1 ? '在线' : '离线' }}
                                    </td>
                                    <td>{{ item.created_at }}</td>
                                </template>
                                
                                <!-- 代理列表数据 -->
                                <template v-else-if="currentPage === 'proxy'">
                                    <td>{{ item.name }}</td>
                                    <td>{{ item.port }}</td>
                                    <td>
                                        <span class="status-dot" :class="item.status === 'running' ? 'online' : 'offline'"></span>
                                        {{ item.status === 'running' ? '运行中' : '已停止' }}
                                    </td>
                                    <td>{{ item.application ? item.application.name : '-' }}</td>
                                    <td>{{ item.description }}</td>
                                    <td>{{ item.created_at }}</td>
                                </template>
                                
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-action" @click="handleConfig(item)">配置</button>
                                        <button class="btn-action" @click="handleAlert(item)">订阅警报</button>
                                        <button class="btn-action" @click="handleDelete(item)" style="color: #F5222D;">删除</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- 分页 -->
                <div class="pagination-section">
                    <div class="pagination-info">共 {{ totalItems }} 条记录</div>
                    <div class="pagination">
                        <button class="pagination-btn" :disabled="currentPage === 1" @click="goToPage(1)">1</button>
                        <button class="pagination-btn" :disabled="currentPage === 1" @click="goToPage(currentPage - 1)">‹</button>
                        <button class="pagination-btn" v-for="page in visiblePages" :key="page" :class="{ active: page === currentPage }" @click="goToPage(page)">{{ page }}</button>
                        <button class="pagination-btn" :disabled="currentPage === totalPages" @click="goToPage(currentPage + 1)">›</button>
                        <button class="pagination-btn" :disabled="currentPage === totalPages" @click="goToPage(totalPages)">{{ totalPages }}</button>
                        
                        <div class="pagination-size">
                            <span>10条/页</span>
                        </div>
                        
                        <div class="pagination-jump">
                            <span>跳至</span>
                            <input type="number" class="pagination-input" v-model="jumpPage" @keyup.enter="jumpToPage">
                            <span>页</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data() {
                return {
                    currentPage: 'proxy',
                    currentSubPage: 'application',
                    searchForm: {
                        name: '',
                        status: '',
                        protocol: '',
                        os: '',
                        online: ''
                    },
                    selectedItems: [],
                    jumpPage: 1,
                    currentPageNum: 1,
                    pageSize: 10,
                    totalItems: 0,
                    tableData: [],
                    loading: false,
                    // API基础URL
                    apiBaseUrl: 'http://127.0.0.1:8080/v1'
                }
            },
            computed: {
                isAllSelected() {
                    return this.selectedItems.length === this.tableData.length && this.tableData.length > 0;
                },
                totalPages() {
                    return Math.ceil(this.totalItems / this.pageSize);
                },
                visiblePages() {
                    const pages = [];
                    const start = Math.max(1, this.currentPageNum - 2);
                    const end = Math.min(this.totalPages, this.currentPageNum + 2);
                    
                    for (let i = start; i <= end; i++) {
                        pages.push(i);
                    }
                    return pages;
                }
            },
            methods: {
                // API调用方法
                async apiCall(url, options = {}) {
                    try {
                        const response = await fetch(url, {
                            headers: {
                                'Content-Type': 'application/json',
                                ...options.headers
                            },
                            ...options
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        
                        const data = await response.json();
                        return data;
                    } catch (error) {
                        console.error('API调用失败:', error);
                        // 不显示错误消息，让页面正常显示
                        return null;
                    }
                },
                
                // 获取应用列表
                async fetchApplications() {
                    this.loading = true;
                    try {
                        const params = new URLSearchParams({
                            page: this.currentPageNum,
                            page_size: this.pageSize
                        });
                        
                        if (this.searchForm.name) {
                            params.append('name', this.searchForm.name);
                        }
                        if (this.searchForm.protocol) {
                            params.append('application_type', this.searchForm.protocol);
                        }
                        
                        const response = await this.apiCall(`${this.apiBaseUrl}/applications?${params}`);
                        if (response && response.code === 200) {
                            this.tableData = response.data.applications || [];
                            this.totalItems = response.data.total || 0;
                        } else {
                            // API失败时显示默认数据
                            this.tableData = [
                                {
                                    id: 1,
                                    name: '示例应用',
                                    application_type: 'tcp',
                                    port: 8080,
                                    edge_id: 1,
                                    status: 'running',
                                    updated_at: '2024-01-01 12:00:00'
                                }
                            ];
                            this.totalItems = 1;
                            console.warn('API连接失败，显示示例数据');
                        }
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 创建应用
                async createApplication(applicationData) {
                    const params = new URLSearchParams(applicationData);
                    const response = await this.apiCall(`${this.apiBaseUrl}/applications`, {
                        method: 'POST',
                        body: params
                    });
                    
                    if (response && response.code === 200) {
                        this.$message.success('应用创建成功');
                        this.fetchApplications();
                        return true;
                    } else {
                        this.$message.error(response?.message || '创建应用失败');
                        return false;
                    }
                },
                
                // 更新应用
                async updateApplication(id, applicationData) {
                    const params = new URLSearchParams(applicationData);
                    const response = await this.apiCall(`${this.apiBaseUrl}/applications/${id}`, {
                        method: 'PUT',
                        body: params
                    });
                    
                    if (response && response.code === 200) {
                        this.$message.success('应用更新成功');
                        this.fetchApplications();
                        return true;
                    } else {
                        this.$message.error(response?.message || '更新应用失败');
                        return false;
                    }
                },
                
                // 删除应用
                async deleteApplication(id) {
                    const response = await this.apiCall(`${this.apiBaseUrl}/applications/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response && response.code === 200) {
                        this.$message.success('应用删除成功');
                        this.fetchApplications();
                        return true;
                    } else {
                        this.$message.error(response?.message || '删除应用失败');
                        return false;
                    }
                },
                
                // 获取设备列表
                async fetchDevices() {
                    this.loading = true;
                    try {
                        const params = new URLSearchParams({
                            page: this.currentPageNum,
                            page_size: this.pageSize
                        });
                        
                        if (this.searchForm.name) {
                            params.append('name', this.searchForm.name);
                        }
                        if (this.searchForm.os) {
                            params.append('os', this.searchForm.os);
                        }
                        
                        const response = await this.apiCall(`${this.apiBaseUrl}/devices?${params}`);
                        if (response && response.code === 200) {
                            this.tableData = response.data.devices || [];
                            this.totalItems = response.data.total || 0;
                        } else {
                            // API失败时显示默认数据
                            this.tableData = [
                                {
                                    id: 1,
                                    name: '示例设备',
                                    description: '这是一个示例设备',
                                    cpu: 8,
                                    memory: 16384,
                                    disk: 500,
                                    os: 'Linux',
                                    version: 'Ubuntu 20.04',
                                    created_at: '2024-01-01 12:00:00'
                                }
                            ];
                            this.totalItems = 1;
                            console.warn('API连接失败，显示示例数据');
                        }
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 获取连接器列表
                async fetchEdges() {
                    this.loading = true;
                    try {
                        const params = new URLSearchParams({
                            page: this.currentPageNum,
                            page_size: this.pageSize
                        });
                        
                        if (this.searchForm.name) {
                            params.append('name', this.searchForm.name);
                        }
                        if (this.searchForm.status) {
                            params.append('status', this.searchForm.status);
                        }
                        if (this.searchForm.online) {
                            params.append('online', this.searchForm.online);
                        }
                        
                        const response = await this.apiCall(`${this.apiBaseUrl}/edges?${params}`);
                        if (response && response.code === 200) {
                            this.tableData = response.data.edges || [];
                            this.totalItems = response.data.total || 0;
                        } else {
                            // API失败时显示默认数据
                            this.tableData = [
                                {
                                    id: 1,
                                    name: '示例连接器',
                                    description: '这是一个示例连接器',
                                    status: 1,
                                    online: 1,
                                    created_at: '2024-01-01 12:00:00'
                                }
                            ];
                            this.totalItems = 1;
                            console.warn('API连接失败，显示示例数据');
                        }
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 获取代理列表
                async fetchProxies() {
                    this.loading = true;
                    try {
                        const params = new URLSearchParams({
                            page: this.currentPageNum,
                            page_size: this.pageSize
                        });
                        
                        if (this.searchForm.name) {
                            params.append('name', this.searchForm.name);
                        }
                        if (this.searchForm.status) {
                            params.append('status', this.searchForm.status);
                        }
                        
                        const response = await this.apiCall(`${this.apiBaseUrl}/proxies?${params}`);
                        if (response && response.code === 200) {
                            this.tableData = response.data.proxies || [];
                            this.totalItems = response.data.total || 0;
                        } else {
                            // API失败时显示默认数据
                            this.tableData = [
                                {
                                    id: 1,
                                    name: '示例代理',
                                    port: 8080,
                                    status: 'running',
                                    application: {
                                        name: '示例应用'
                                    },
                                    description: '这是一个示例代理',
                                    created_at: '2024-01-01 12:00:00'
                                }
                            ];
                            this.totalItems = 1;
                            console.warn('API连接失败，显示示例数据');
                        }
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 页面切换
                switchPage(page) {
                    this.currentPage = page;
                    this.currentPageNum = 1;
                    this.selectedItems = [];
                    // 先显示默认数据，然后尝试加载真实数据
                    this.initializeDefaultData();
                    
                    if (page === 'application') {
                        this.currentSubPage = 'application';
                        this.fetchApplications();
                    } else if (page === 'connector') {
                        this.fetchEdges();
                    } else if (page === 'proxy') {
                        this.fetchProxies();
                    }
                },
                
                switchSubPage(subPage) {
                    this.currentSubPage = subPage;
                    this.currentPageNum = 1;
                    this.selectedItems = [];
                    // 先显示默认数据，然后尝试加载真实数据
                    this.initializeDefaultData();
                    
                    if (subPage === 'application') {
                        this.fetchApplications();
                    } else if (subPage === 'device') {
                        this.fetchDevices();
                    }
                },
                
                handleSearch() {
                    this.currentPageNum = 1;
                    // 先显示默认数据，然后尝试加载真实数据
                    this.initializeDefaultData();
                    
                    if (this.currentPage === 'application' && this.currentSubPage === 'application') {
                        this.fetchApplications();
                    } else if (this.currentPage === 'application' && this.currentSubPage === 'device') {
                        this.fetchDevices();
                    } else if (this.currentPage === 'connector') {
                        this.fetchEdges();
                    } else if (this.currentPage === 'proxy') {
                        this.fetchProxies();
                    }
                },
                
                handleReset() {
                    this.searchForm = {
                        name: '',
                        status: '',
                        protocol: '',
                        os: '',
                        online: ''
                    };
                    this.handleSearch();
                },
                
                handleNew() {
                    if (this.currentPage === 'application' && this.currentSubPage === 'application') {
                        this.showCreateApplicationDialog();
                    } else if (this.currentPage === 'application' && this.currentSubPage === 'device') {
                        this.showCreateDeviceDialog();
                    } else if (this.currentPage === 'connector') {
                        this.showCreateEdgeDialog();
                    } else if (this.currentPage === 'proxy') {
                        this.showCreateProxyDialog();
                    }
                },
                
                showCreateApplicationDialog() {
                    const name = prompt('请输入应用名称:');
                    if (!name) return;
                    
                    const ip = prompt('请输入IP地址:');
                    if (!ip) return;
                    
                    const port = prompt('请输入端口:');
                    if (!port) return;
                    
                    const edgeId = prompt('请输入连接器ID:');
                    if (!edgeId) return;
                    
                    this.createApplication({
                        name: name,
                        ip: ip,
                        port: port,
                        edge_id: edgeId,
                        application_type: 'tcp'
                    });
                },
                toggleSelectAll() {
                    if (this.isAllSelected) {
                        this.selectedItems = [];
                    } else {
                        this.selectedItems = this.tableData.map(item => item.id);
                    }
                },
                toggleSelect(id) {
                    const index = this.selectedItems.indexOf(id);
                    if (index > -1) {
                        this.selectedItems.splice(index, 1);
                    } else {
                        this.selectedItems.push(id);
                    }
                },
                clearSelection() {
                    this.selectedItems = [];
                },
                getStatusText(status) {
                    const statusMap = {
                        'online': '运行中',
                        'offline': '关闭',
                        'error': '异常'
                    };
                    return statusMap[status] || status;
                },
                handleConfig(item) {
                    console.log('配置:', item);
                    // 这里可以打开配置对话框
                },
                
                handleAlert(item) {
                    console.log('订阅警报:', item);
                    // 这里可以打开订阅警报对话框
                },
                
                handleDelete(item) {
                    if (confirm(`确定删除 ${item.name} 吗？`)) {
                        if (this.currentPage === 'application' && this.currentSubPage === 'application') {
                            this.deleteApplication(item.id);
                        } else if (this.currentPage === 'application' && this.currentSubPage === 'device') {
                            this.deleteDevice(item.id);
                        } else if (this.currentPage === 'connector') {
                            this.deleteEdge(item.id);
                        } else if (this.currentPage === 'proxy') {
                            this.deleteProxy(item.id);
                        }
                    }
                },
                
                // 其他CRUD方法
                async deleteDevice(id) {
                    const response = await this.apiCall(`${this.apiBaseUrl}/devices/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response && response.code === 200) {
                        this.$message.success('设备删除成功');
                        this.fetchDevices();
                    } else {
                        this.$message.error(response?.message || '删除设备失败');
                    }
                },
                
                async deleteEdge(id) {
                    const response = await this.apiCall(`${this.apiBaseUrl}/edges/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response && response.code === 200) {
                        this.$message.success('连接器删除成功');
                        this.fetchEdges();
                    } else {
                        this.$message.error(response?.message || '删除连接器失败');
                    }
                },
                
                async deleteProxy(id) {
                    const response = await this.apiCall(`${this.apiBaseUrl}/proxies/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response && response.code === 200) {
                        this.$message.success('代理删除成功');
                        this.fetchProxies();
                    } else {
                        this.$message.error(response?.message || '删除代理失败');
                    }
                },
                
                showCreateDeviceDialog() {
                    const name = prompt('请输入设备名称:');
                    if (!name) return;
                    
                    const description = prompt('请输入设备描述:');
                    if (!description) return;
                    
                    // 这里可以调用创建设备的API
                    console.log('创建设备:', { name, description });
                },
                
                showCreateEdgeDialog() {
                    const name = prompt('请输入连接器名称:');
                    if (!name) return;
                    
                    const description = prompt('请输入连接器描述:');
                    if (!description) return;
                    
                    // 这里可以调用创建连接器的API
                    console.log('创建连接器:', { name, description });
                },
                
                showCreateProxyDialog() {
                    const name = prompt('请输入代理名称:');
                    if (!name) return;
                    
                    const port = prompt('请输入端口:');
                    if (!port) return;
                    
                    // 这里可以调用创建代理的API
                    console.log('创建代理:', { name, port });
                },
                
                goToPage(page) {
                    if (page >= 1 && page <= this.totalPages) {
                        this.currentPageNum = page;
                        this.handleSearch();
                    }
                },
                
                jumpToPage() {
                    this.goToPage(parseInt(this.jumpPage));
                },
                
                // 初始化默认数据，防止白屏
                initializeDefaultData() {
                    this.tableData = [
                        {
                            id: 1,
                            name: '示例代理',
                            port: 8080,
                            status: 'running',
                            application: {
                                name: '示例应用'
                            },
                            description: '这是一个示例代理',
                            created_at: '2024-01-01 12:00:00'
                        }
                    ];
                    this.totalItems = 1;
                },
                
                // 获取页面标题
                getPageTitle() {
                    if (this.currentPage === 'application' && this.currentSubPage === 'application') {
                        return '应用列表';
                    } else if (this.currentPage === 'application' && this.currentSubPage === 'device') {
                        return '设备列表';
                    } else if (this.currentPage === 'connector') {
                        return '连接器列表';
                    } else if (this.currentPage === 'proxy') {
                        return '代理列表';
                    }
                    return '列表';
                }
            },
            
            // 组件挂载时初始化数据
            mounted() {
                // 先显示默认数据，然后尝试加载真实数据
                this.initializeDefaultData();
                this.fetchProxies();
            }
        });
    </script>
</body>
</html>